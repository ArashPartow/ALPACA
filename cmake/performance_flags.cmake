MESSAGE( STATUS "Set performance flags" )

set(STANDARD_FLAGS "-m64 -g")
set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${STANDARD_FLAGS}")

set(COMPILER_ENV "$ENV{COMPILER}")
if(ALPACA_ENV STREQUAL "LRZ")
   set(MACHINE_FLAGS "${MACHINE_FLAGS} -D PERFORMANCE")
   set(MACHINE_PERFORMANCE_FLAGS "${MACHINE_PERFORMANCE_FLAGS}")
elseif(ALPACA_ENV STREQUAL "SNG")
    set(MACHINE_FLAGS "${MACHINE_FLAGS} -D PERFORMANCE")
    if(COMPILER_ENV STREQUAL "INTEL")
        set(MACHINE_PERFORMANCE_FLAGS "${MACHINE_PERFORMANCE_FLAGS} -vecabi=cmdtarget -xHost -qopt-zmm-usage=high -qopt-report=5")
    else(COMPILER_ENV STREQUAL "INTEL")
        set(MACHINE_PERFORMANCE_FLAGS "${MACHINE_PERFORMANCE_FLAGS} -ftree-vectorize -mavx512f -mavx512cd -ffast-math -march=skylake-avx512 -fopt-info-vec ")
    endif(COMPILER_ENV STREQUAL "INTEL")
elseif(ALPACA_ENV STREQUAL "ALPACA_USER")
else(ALPACA_ENV STREQUAL "LRZ")
   set(MACHINE_PERFORMANCE_FLAGS "${MACHINE_PERFORMANCE_FLAGS}")
endif(ALPACA_ENV STREQUAL "LRZ")

set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${MACHINE_FLAGS}")

option(DBG "Debug" OFF)
if(DBG)
   set(ALPACA_CXX_FLAGS "-O0")
   set(PACO_CXX_FLAGS "-O0")
else(DBG)
   set(ALPACA_CXX_FLAGS "-O3 -DNDEBUG")
   set(ALPACA_CXX_FLAGS "${ALPACA_CXX_FLAGS} ${MACHINE_PERFORMANCE_FLAGS}")
   set(PACO_CXX_FLAGS "")
endif(DBG)

option(SYMMETRY_FLAGS "Symmetry preserving flags" OFF)

set(ALPACA_SYMMETRY_FLAGS "")
if(ALPACA_ENV STREQUAL "LRZ" OR ALPACA_ENV STREQUAL "SNG")
    if(COMPILER_ENV STREQUAL "INTEL")
        if (SYMMETRY_FLAGS)
            set(ALPACA_SYMMETRY_FLAGS "-fp-model precise")
        else(SYMMETRY_FLAGS)
            set(ALPACA_SYMMETRY_FLAGS "-fp-model fast=2")
        endif (SYMMETRY_FLAGS)
    endif(COMPILER_ENV STREQUAL "INTEL")
endif(ALPACA_ENV STREQUAL "LRZ" OR ALPACA_ENV STREQUAL "SNG")
